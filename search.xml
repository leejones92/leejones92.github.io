<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2019ä¹¦å•</title>
    <url>/2019/02/16/book/20190216-2019%E4%B9%A6%E5%8D%95/</url>
    <content><![CDATA[<ul>
<li>ä»é›¶å¼€å§‹å­¦æ¶æ„ -æè¿å <a href="https://book.douban.com/subject/30335935/">douban 8.5</a></li>
</ul>
]]></content>
      <categories>
        <category>ä¹¦å•</category>
        <category>book</category>
      </categories>
      <tags>
        <tag>2019</tag>
      </tags>
  </entry>
  <entry>
    <title>page</title>
    <url>/2021/01/14/book/20210114-%E4%BF%9D%E9%99%A9%E5%AD%A601/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>book</category>
      </categories>
  </entry>
  <entry>
    <title>zkå®ç°åˆ†å¸ƒå¼é”</title>
    <url>/2019/04/22/distribute/20190422-zk%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    <content><![CDATA[<h3 id="åˆ†å¸ƒå¼é”å®ç°"><a href="#åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="åˆ†å¸ƒå¼é”å®ç°"></a>åˆ†å¸ƒå¼é”å®ç°</h3><ul>
<li>åŸºäºæ•°æ®åº“</li>
<li>åŸºäºredis</li>
<li>åŸºäºzookeeper</li>
</ul>
<h4 id="åŸºäºzkå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºzkå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºzkå®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºzkå®ç°åˆ†å¸ƒå¼é”</h4><h5 id="zkä»‹ç»"><a href="#zkä»‹ç»" class="headerlink" title="zkä»‹ç»"></a>zkä»‹ç»</h5><ul>
<li>Zookeeperï¼ˆä¸šç•Œç®€ç§°zkï¼‰æ˜¯ä¸€ç§æä¾›é…ç½®ç®¡ç†ã€åˆ†å¸ƒå¼ååŒä»¥åŠå‘½åçš„ä¸­å¿ƒåŒ–æœåŠ¡</li>
<li>Zookeeperæä¾›ä¸€ä¸ªå¤šå±‚çº§çš„èŠ‚ç‚¹å‘½åç©ºé—´ï¼ˆèŠ‚ç‚¹ç§°ä¸ºznodeï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ç”¨ä¸€ä¸ªä»¥æ–œæ ï¼ˆ/ï¼‰åˆ†éš”çš„è·¯å¾„è¡¨ç¤ºï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰çˆ¶èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹é™¤å¤–ï¼‰ï¼Œéå¸¸ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿ</li>
<li>é›†ç¾¤éƒ¨ç½² 2n+1å°æœºå™¨<blockquote>
<p>è¿‡åŠæœºå™¨æ˜¯å¯ç”¨çš„ï¼ˆèƒ½å¤Ÿå®¹å¿ä¸€å®šçš„æœºå™¨æ•…éšœï¼‰ï¼Œé‚£ä¹ˆzookeeperæœ¬èº«ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚å®¢æˆ·ç«¯åœ¨ä½¿ç”¨zookeeperæ—¶ï¼Œéœ€è¦çŸ¥é“é›†ç¾¤æœºå™¨åˆ—è¡¨ï¼Œé€šè¿‡ä¸é›†ç¾¤ä¸­çš„æŸä¸€å°æœºå™¨å»ºç«‹TCPè¿æ¥æ¥ä½¿ç”¨æœåŠ¡ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªTCPé“¾æ¥æ¥å‘é€è¯·æ±‚ã€è·å–ç»“æœã€è·å–ç›‘å¬äº‹ä»¶ä»¥åŠå‘é€å¿ƒè·³åŒ…ã€‚å¦‚æœè¿™ä¸ªè¿æ¥å¼‚å¸¸æ–­å¼€äº†ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°å¦å¤–çš„æœºå™¨ä¸Š</p>
<ul>
<li>è¯»è¯·æ±‚<br/><br>å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚å¯ä»¥è¢«é›†ç¾¤ä¸­çš„ä»»æ„ä¸€å°æœºå™¨å¤„ç†ï¼Œå¦‚æœè¯»è¯·æ±‚åœ¨èŠ‚ç‚¹ä¸Šæ³¨å†Œäº†ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨ä¹Ÿæ˜¯ç”±æ‰€è¿æ¥çš„zookeeperæœºå™¨æ¥å¤„ç†.</li>
<li>å†™è¯·æ±‚<br/><br>å¯¹äºå†™è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šåŒæ—¶å‘ç»™å…¶ä»–zookeeperæœºå™¨å¹¶ä¸”è¾¾æˆä¸€è‡´åï¼Œè¯·æ±‚æ‰ä¼šè¿”å›æˆåŠŸã€‚</li>
</ul>
</blockquote>
</li>
<li>æœ‰åºæ€§<blockquote>
<p>æœ‰åºæ€§æ˜¯zookeeperä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæ‰€æœ‰çš„æ›´æ–°éƒ½æ˜¯å…¨å±€æœ‰åºçš„ï¼Œæ¯ä¸ªæ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´æˆ³ç§°ä¸ºzxidï¼ˆZookeeper Transaction Idï¼‰ã€‚è€Œè¯»è¯·æ±‚åªä¼šç›¸å¯¹äºæ›´æ–°æœ‰åºï¼Œä¹Ÿå°±æ˜¯è¯»è¯·æ±‚çš„è¿”å›ç»“æœä¸­ä¼šå¸¦æœ‰è¿™ä¸ªzookeeperæœ€æ–°çš„zxid</p>
</blockquote>
</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/007DdbdYly1g2ba2zuq19j30h905kmxt.jpg" alt=""></p>
<h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><ul>
<li>èŠ‚ç‚¹æ€§è´¨ <br/><ol>
<li>æœ‰åºèŠ‚ç‚¹ï¼šå‡å¦‚å½“å‰æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸º/lockï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºå­èŠ‚ç‚¹ï¼›zookeeperæä¾›äº†ä¸€ä¸ªå¯é€‰çš„æœ‰åºç‰¹æ€§ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå­èŠ‚ç‚¹â€œ/lock/node-â€å¹¶ä¸”æŒ‡æ˜æœ‰åºï¼Œé‚£ä¹ˆzookeeperåœ¨ç”Ÿæˆå­èŠ‚ç‚¹æ—¶ä¼šæ ¹æ®å½“å‰çš„å­èŠ‚ç‚¹æ•°é‡è‡ªåŠ¨æ·»åŠ æ•´æ•°åºå·ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç”Ÿæˆçš„å­èŠ‚ç‚¹ä¸º/lock/node-0000000000ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ™ä¸º/lock/node-0000000001ï¼Œä¾æ¬¡ç±»æ¨ã€‚</li>
<li>ä¸´æ—¶èŠ‚ç‚¹ï¼šå®¢æˆ·ç«¯å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåœ¨ä¼šè¯ç»“æŸæˆ–è€…ä¼šè¯è¶…æ—¶åï¼Œzookeeperä¼šè‡ªåŠ¨åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</li>
<li>äº‹ä»¶ç›‘å¬ï¼šåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å¯¹èŠ‚ç‚¹è®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œå½“èŠ‚ç‚¹æ•°æ®æˆ–ç»“æ„å˜åŒ–æ—¶ï¼Œzookeeperä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚å½“å‰zookeeperæœ‰å¦‚ä¸‹å››ç§äº‹ä»¶ï¼š1ï¼‰èŠ‚ç‚¹åˆ›å»ºï¼›2ï¼‰èŠ‚ç‚¹åˆ é™¤ï¼›3ï¼‰èŠ‚ç‚¹æ•°æ®ä¿®æ”¹ï¼›4ï¼‰å­èŠ‚ç‚¹å˜æ›´ã€‚</li>
</ol>
</li>
<li>å®ç°<ol>
<li>å®¢æˆ·ç«¯è¿æ¥zookeeperï¼Œå¹¶åœ¨/lockä¸‹åˆ›å»ºä¸´æ—¶çš„ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„å­èŠ‚ç‚¹ä¸º/lock/lock-0000000000ï¼Œç¬¬äºŒä¸ªä¸º/lock/lock-0000000001ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>å®¢æˆ·ç«¯è·å–/lockä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼Œå¦åˆ™ç›‘å¬/lockçš„å­èŠ‚ç‚¹å˜æ›´æ¶ˆæ¯ï¼Œè·å¾—å­èŠ‚ç‚¹å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼›</li>
<li>æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼›</li>
<li>å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚</li>
</ol>
</li>
<li>é—®é¢˜<blockquote>
<p>æ­¥éª¤1ä¸­åˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹èƒ½å¤Ÿä¿è¯åœ¨æ•…éšœçš„æƒ…å†µä¸‹é”ä¹Ÿèƒ½è¢«é‡Šæ”¾ï¼Œè€ƒè™‘è¿™ä¹ˆä¸ªåœºæ™¯ï¼šå‡å¦‚å®¢æˆ·ç«¯aå½“å‰åˆ›å»ºçš„å­èŠ‚ç‚¹ä¸ºåºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œè·å¾—é”ä¹‹åå®¢æˆ·ç«¯æ‰€åœ¨æœºå™¨å®•æœºäº†ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰ä¸»åŠ¨åˆ é™¤å­èŠ‚ç‚¹ï¼›å¦‚æœåˆ›å»ºçš„æ˜¯æ°¸ä¹…çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªé”æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼Œå¯¼è‡´æ­»é”ï¼›ç”±äºåˆ›å»ºçš„æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯å®•æœºåï¼Œè¿‡äº†ä¸€å®šæ—¶é—´zookeeperæ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…åˆ¤æ–­ä¼šè¯å¤±æ•ˆï¼Œå°†ä¸´æ—¶èŠ‚ç‚¹åˆ é™¤ä»è€Œé‡Šæ”¾é”ã€‚</p>
</blockquote>
</li>
<li>ä¼˜åŒ–<blockquote>
<p>å‡å¦‚å½“å‰æœ‰1000ä¸ªèŠ‚ç‚¹åœ¨ç­‰å¾…é”ï¼Œå¦‚æœè·å¾—é”çš„å®¢æˆ·ç«¯é‡Šæ”¾é”æ—¶ï¼Œè¿™1000ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šè¢«å”¤é†’ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºâ€œç¾Šç¾¤æ•ˆåº”â€ï¼›åœ¨è¿™ç§ç¾Šç¾¤æ•ˆåº”ä¸­ï¼Œzookeeperéœ€è¦é€šçŸ¥1000ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™ä¼šé˜»å¡å…¶ä»–çš„æ“ä½œï¼Œæœ€å¥½çš„æƒ…å†µåº”è¯¥åªå”¤é†’æ–°çš„æœ€å°èŠ‚ç‚¹å¯¹åº”çš„å®¢æˆ·ç«¯ã€‚åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨è®¾ç½®äº‹ä»¶ç›‘å¬æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯åº”è¯¥å¯¹åˆšå¥½åœ¨å®ƒä¹‹å‰çš„å­èŠ‚ç‚¹è®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œä¾‹å¦‚å­èŠ‚ç‚¹åˆ—è¡¨ä¸º/lock/lock-0000000000ã€/lock/lock-0000000001ã€/lock/lock-0000000002ï¼Œåºå·ä¸º1çš„å®¢æˆ·ç«¯ç›‘å¬åºå·ä¸º0çš„å­èŠ‚ç‚¹åˆ é™¤æ¶ˆæ¯ï¼Œåºå·ä¸º2çš„ç›‘å¬åºå·ä¸º1çš„å­èŠ‚ç‚¹åˆ é™¤æ¶ˆæ¯ã€‚</p>
</blockquote>
</li>
<li><strong>æœ€ç»ˆç®—æ³•</strong><ol>
<li>å®¢æˆ·ç«¯è¿æ¥zookeeperï¼Œå¹¶åœ¨/lockä¸‹åˆ›å»ºä¸´æ—¶çš„ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„å­èŠ‚ç‚¹ä¸º/lock/lock-0000000000ï¼Œç¬¬äºŒä¸ªä¸º/lock/lock-0000000001ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>å®¢æˆ·ç«¯è·å–/lockä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼Œå¦åˆ™ç›‘å¬åˆšå¥½åœ¨è‡ªå·±ä¹‹å‰ä¸€ä½çš„å­èŠ‚ç‚¹åˆ é™¤æ¶ˆæ¯ï¼Œè·å¾—å­èŠ‚ç‚¹å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼›</li>
<li>æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼›</li>
<li>å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚<h5 id="Curatoræºç å‰–æ"><a href="#Curatoræºç å‰–æ" class="headerlink" title="Curatoræºç å‰–æ"></a>Curatoræºç å‰–æ</h5></li>
</ol>
</li>
<li>å¼•åŒ…<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.curator&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;curator-recipes&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>æºç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    &#x2F;&#x2F;åˆ›å»ºzookeeperçš„å®¢æˆ·ç«¯</span><br><span class="line">    RetryPolicy retryPolicy &#x3D; new ExponentialBackoffRetry(1000, 3);</span><br><span class="line">    CuratorFramework client &#x3D; CuratorFrameworkFactory.newClient(&quot;10.21.41.181:2181,10.21.42.47:2181,10.21.49.252:2181&quot;, retryPolicy);</span><br><span class="line">    client.start();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;åˆ›å»ºåˆ†å¸ƒå¼é”, é”ç©ºé—´çš„æ ¹èŠ‚ç‚¹è·¯å¾„ä¸º&#x2F;curator&#x2F;lock</span><br><span class="line">    InterProcessMutex mutex &#x3D; new InterProcessMutex(client, &quot;&#x2F;curator&#x2F;lock&quot;);</span><br><span class="line">    mutex.acquire();</span><br><span class="line">    &#x2F;&#x2F;è·å¾—äº†é”, è¿›è¡Œä¸šåŠ¡æµç¨‹</span><br><span class="line">    System.out.println(&quot;Enter mutex&quot;);</span><br><span class="line">    &#x2F;&#x2F;å®Œæˆä¸šåŠ¡æµç¨‹, é‡Šæ”¾é”</span><br><span class="line">    mutex.release();</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;å…³é—­å®¢æˆ·ç«¯</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¥éª¤ç®€å• æ ¸å¿ƒmutex.acquire() å’Œ mutex.release();</p>
<p>mutex.acquire()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * è·å–é”ï¼Œå½“é”è¢«å ç”¨æ—¶ä¼šé˜»å¡ç­‰å¾…ï¼Œè¿™ä¸ªæ“ä½œæ”¯æŒåŒçº¿ç¨‹çš„å¯é‡å…¥ï¼ˆä¹Ÿå°±æ˜¯é‡å¤è·å–é”ï¼‰ï¼Œacquireçš„æ¬¡æ•°éœ€è¦ä¸releaseçš„æ¬¡æ•°ç›¸åŒã€‚</span><br><span class="line"> * @throws Exception ZK errors, connection interruptions</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Override</span><br><span class="line">public void acquire() throws Exception</span><br><span class="line">&#123;</span><br><span class="line">    if ( !internalLock(-1, null) )</span><br><span class="line">    &#123;</span><br><span class="line">        throw new IOException(&quot;Lost connection while trying to acquire lock: &quot; + basePath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>internalLock</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private boolean internalLock(long time, TimeUnit unit) throws Exception</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;è¿™é‡Œå¤„ç†åŒçº¿ç¨‹çš„å¯é‡å…¥æ€§ï¼Œå¦‚æœå·²ç»è·å¾—é”ï¼Œé‚£ä¹ˆåªæ˜¯åœ¨å¯¹åº”çš„æ•°æ®ç»“æ„ä¸­å¢åŠ acquireçš„æ¬¡æ•°ç»Ÿè®¡ï¼Œç›´æ¥è¿”å›æˆåŠŸ</span><br><span class="line">    Thread currentThread &#x3D; Thread.currentThread();</span><br><span class="line">    LockData lockData &#x3D; threadData.get(currentThread);</span><br><span class="line">    if ( lockData !&#x3D; null )</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F; re-entering</span><br><span class="line">        lockData.lockCount.incrementAndGet();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;è¿™é‡Œæ‰çœŸæ­£å»zookeeperä¸­è·å–é”</span><br><span class="line">    String lockPath &#x3D; internals.attemptLock(time, unit, getLockNodeBytes());</span><br><span class="line">    if ( lockPath !&#x3D; null )</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;è·å¾—é”ä¹‹åï¼Œè®°å½•å½“å‰çš„çº¿ç¨‹è·å¾—é”çš„ä¿¡æ¯ï¼Œåœ¨é‡å…¥æ—¶åªéœ€åœ¨LockDataä¸­å¢åŠ æ¬¡æ•°ç»Ÿè®¡å³å¯</span><br><span class="line">        LockData newLockData &#x3D; new LockData(currentThread, lockPath);</span><br><span class="line">        threadData.put(currentThread, newLockData);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;åœ¨é˜»å¡è¿”å›æ—¶ä»ç„¶è·å–ä¸åˆ°é”ï¼Œè¿™é‡Œä¸Šä¸‹æ–‡çš„å¤„ç†éšå«çš„æ„æ€ä¸ºzookeeperé€šä¿¡å¼‚å¸¸</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>zookeeperè·å–é”</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String attemptLock(long time, TimeUnit unit, byte[] lockNodeBytes) throws Exception</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;å‚æ•°åˆå§‹åŒ–ï¼Œæ­¤å¤„çœç•¥</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">   </span><br><span class="line">    &#x2F;&#x2F;è‡ªæ—‹è·å–é”</span><br><span class="line">    while ( !isDone )</span><br><span class="line">    &#123;</span><br><span class="line">        isDone &#x3D; true;</span><br><span class="line"></span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F;åœ¨é”ç©ºé—´ä¸‹åˆ›å»ºä¸´æ—¶ä¸”æœ‰åºçš„å­èŠ‚ç‚¹</span><br><span class="line">            ourPath &#x3D; driver.createsTheLock(client, path, localLockNodeBytes);</span><br><span class="line">            &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦è·å¾—é”ï¼ˆå­èŠ‚ç‚¹åºå·æœ€å°ï¼‰ï¼Œè·å¾—é”åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™é˜»å¡ç­‰å¾…å‰ä¸€ä¸ªå­èŠ‚ç‚¹åˆ é™¤é€šçŸ¥</span><br><span class="line">            hasTheLock &#x3D; internalLockLoop(startMillis, millisToWait, ourPath);</span><br><span class="line">        &#125;</span><br><span class="line">        catch ( KeeperException.NoNodeException e )</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F;å¯¹äºNoNodeExceptionï¼Œä»£ç ä¸­ç¡®ä¿äº†åªæœ‰å‘ç”Ÿsessionè¿‡æœŸæ‰ä¼šåœ¨è¿™é‡ŒæŠ›å‡ºNoNodeExceptionï¼Œå› æ­¤è¿™é‡Œæ ¹æ®é‡è¯•ç­–ç•¥è¿›è¡Œé‡è¯•</span><br><span class="line">            if ( client.getZookeeperClient().getRetryPolicy().allowRetry(retryCount++, System.currentTimeMillis() - startMillis, RetryLoop.getDefaultRetrySleeper()) )</span><br><span class="line">            &#123;</span><br><span class="line">                isDone &#x3D; false;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                throw e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;å¦‚æœè·å¾—é”åˆ™è¿”å›è¯¥å­èŠ‚ç‚¹çš„è·¯å¾„</span><br><span class="line">    if ( hasTheLock )</span><br><span class="line">    &#123;</span><br><span class="line">        return ourPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤æ­¥</p>
</li>
</ul>
<ol>
<li>driver.createsTheLockï¼šåˆ›å»ºä¸´æ—¶ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼Œé‡Œé¢å®ç°æ¯”è¾ƒç®€å•ä¸åšå±•å¼€ï¼Œä¸»è¦å…³æ³¨å‡ ç§èŠ‚ç‚¹çš„æ¨¡å¼ï¼š1ï¼‰PERSISTENTï¼ˆæ°¸ä¹…ï¼‰ï¼›2ï¼‰PERSISTENT_SEQUENTIALï¼ˆæ°¸ä¹…ä¸”æœ‰åºï¼‰ï¼›3ï¼‰EPHEMERALï¼ˆä¸´æ—¶ï¼‰ï¼›4ï¼‰EPHEMERAL_SEQUENTIALï¼ˆä¸´æ—¶ä¸”æœ‰åºï¼‰ã€‚</li>
<li>internalLockLoopï¼šé˜»å¡ç­‰å¾…ç›´åˆ°è·å¾—é”ã€‚</li>
</ol>
<p>internalLockLoop<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;è‡ªæ—‹ç›´è‡³è·å¾—é”</span><br><span class="line">while ( (client.getState() &#x3D;&#x3D; CuratorFrameworkState.STARTED) &amp;&amp; !haveTheLock )</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;è·å–æ‰€æœ‰çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶ä¸”æŒ‰åºå·ä»å°åˆ°å¤§æ’åº</span><br><span class="line">    List&lt;String&gt;        children &#x3D; getSortedChildren();</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;æ ¹æ®åºå·åˆ¤æ–­å½“å‰å­èŠ‚ç‚¹æ˜¯å¦ä¸ºæœ€å°å­èŠ‚ç‚¹</span><br><span class="line">    String              sequenceNodeName &#x3D; ourPath.substring(basePath.length() + 1); &#x2F;&#x2F; +1 to include the slash</span><br><span class="line">    PredicateResults    predicateResults &#x3D; driver.getsTheLock(client, children, sequenceNodeName, maxLeases);</span><br><span class="line">    if ( predicateResults.getsTheLock() )</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;å¦‚æœä¸ºæœ€å°å­èŠ‚ç‚¹åˆ™è®¤ä¸ºè·å¾—é”</span><br><span class="line">        haveTheLock &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;å¦åˆ™è·å–å‰ä¸€ä¸ªå­èŠ‚ç‚¹</span><br><span class="line">        String  previousSequencePath &#x3D; basePath + &quot;&#x2F;&quot; + predicateResults.getPathToWatch();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;è¿™é‡Œä½¿ç”¨å¯¹è±¡ç›‘è§†å™¨åšçº¿ç¨‹åŒæ­¥ï¼Œå½“è·å–ä¸åˆ°é”æ—¶ç›‘å¬å‰ä¸€ä¸ªå­èŠ‚ç‚¹åˆ é™¤æ¶ˆæ¯å¹¶ä¸”è¿›è¡Œwait()ï¼Œå½“å‰ä¸€ä¸ªå­èŠ‚ç‚¹åˆ é™¤ï¼ˆä¹Ÿå°±æ˜¯é”é‡Šæ”¾ï¼‰æ—¶ï¼Œå›è°ƒä¼šé€šè¿‡notifyAllå”¤é†’æ­¤çº¿ç¨‹ï¼Œæ­¤çº¿ç¨‹ç»§ç»­è‡ªæ—‹åˆ¤æ–­æ˜¯å¦è·å¾—é”</span><br><span class="line">        synchronized(this)</span><br><span class="line">        &#123;</span><br><span class="line">            try </span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;è¿™é‡Œä½¿ç”¨getData()æ¥å£è€Œä¸æ˜¯checkExists()æ˜¯å› ä¸ºï¼Œå¦‚æœå‰ä¸€ä¸ªå­èŠ‚ç‚¹å·²ç»è¢«åˆ é™¤äº†é‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸”ä¸ä¼šè®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œè€ŒcheckExistsè™½ç„¶ä¹Ÿå¯ä»¥è·å–åˆ°èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨çš„ä¿¡æ¯ä½†æ˜¯åŒæ—¶è®¾ç½®äº†ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨å…¶å®æ°¸è¿œä¸ä¼šè§¦å‘ï¼Œå¯¹äºzookeeperæ¥è¯´å±äºèµ„æºæ³„éœ²</span><br><span class="line">                client.getData().usingWatcher(watcher).forPath(previousSequencePath);</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F;å¦‚æœè®¾ç½®äº†é˜»å¡ç­‰å¾…çš„æ—¶é—´</span><br><span class="line">                if ( millisToWait !&#x3D; null )</span><br><span class="line">                &#123;</span><br><span class="line">                    millisToWait -&#x3D; (System.currentTimeMillis() - startMillis);</span><br><span class="line">                    startMillis &#x3D; System.currentTimeMillis();</span><br><span class="line">                    if ( millisToWait &lt;&#x3D; 0 )</span><br><span class="line">                    &#123;</span><br><span class="line">                        doDelete &#x3D; true;    &#x2F;&#x2F; ç­‰å¾…æ—¶é—´åˆ°è¾¾ï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    &#x2F;&#x2F;ç­‰å¾…ç›¸åº”çš„æ—¶é—´</span><br><span class="line">                    wait(millisToWait);</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                   &#x2F;&#x2F;æ°¸è¿œç­‰å¾…</span><br><span class="line">                    wait();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch ( KeeperException.NoNodeException e ) </span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;ä¸Šé¢ä½¿ç”¨getDataæ¥è®¾ç½®ç›‘å¬å™¨æ—¶ï¼Œå¦‚æœå‰ä¸€ä¸ªå­èŠ‚ç‚¹å·²ç»è¢«åˆ é™¤é‚£ä¹ˆä¼šæŠ›å‡ºNoNodeExceptionï¼Œåªéœ€è¦è‡ªæ—‹ä¸€æ¬¡å³å¯ï¼Œæ— éœ€é¢å¤–å¤„ç†</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h4><pre><code>åé¢ä¼šå¢åŠ redisåˆ†å¸ƒå¼é”å®ç°åˆ†æ
</code></pre>]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
        <category>distribute</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title>2018å¹´åº¦æ€»ç»“</title>
    <url>/2019/01/31/life/20190131-2018%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>è½¬çœ¼é—´2018å¹´å·²ç»è¿‡å»,æ¥XXå…¬å¸ä¹Ÿä¸€å¹´å¤šäº†,è¿™ä¸€å¹´æ”¶è·æœ‰,æ•™è®­ä¹Ÿæœ‰,å¹´åº•äº†,æ¥ä¸€æ³¢æ€»ç»“ã€‚ä»å·¥ä½œ,å­¦ä¹ åˆ°ç”Ÿæ´»æ¥è®°ä¸€è®°ã€‚<br>å…ˆè¯´ç‚¹å¤§äº‹,ä»ä¸‰æœˆä»½è´¸æ˜“æˆ˜è¯´èµ·,å’Œè€ç¾å¹²äº†,å—¯,è¿˜æ²¡ç»“æŸ,ç°é‡‘è´·å…¬å¸å°¸æ¨ªéé‡,æ¥ç€æˆ¿åœ°äº§å¼€å§‹ç–²è½¯,ç„¶åå¹´åº•è£å‘˜æ½®,å¯’å†¬å·²è‡³,åŒäº‹å·²æœ‰è¢«ä¼˜åŒ–.2019ä¹Ÿæ˜¯ä¸å¥½è¿‡,å¹²æŠ€æœ¯çš„è¿˜æ˜¯è¦ä¸€ç›´å­¦ä¹ ,æ—¶åˆ»å‡†å¤‡ç€.</p>
<h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>ä¸ŠåŠå¹´,åšçš„åˆ›æ–°é¡¹ç›®æ²¡æœ‰èµ¶ä¸Šå¥½æ—¶å€™,â€¦â€¦,ç„¶åè¢«å®‰æ’åšä¸šåŠ¡å¼€å‘,å½“æ—¶å¯¹äºä¸šåŠ¡ç³»ç»Ÿä¸æ˜¯å¤ªæ„Ÿå†’,å¯¹ä¸šåŠ¡ä¹Ÿä¸ç†Ÿæ‚‰,å“©å“©å•¦å•¦å‘†äº†ä¸€ä¸ªæœˆ,ç„¶åå»äº†å…¶ä»–éƒ¨é—¨,åšäº†ä¸€äº›çº¯æŠ€æœ¯çš„å·¥ä½œ.</p>
<h2 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h2><p>ä»å¹´åˆå¼€å§‹,æŠŠä¸€äº›çŸ¥è¯†æ…¢æ…¢çš„æ¡èµ·æ¥,ä»jvmåˆ°å¤šçº¿ç¨‹å¹¶å‘,javaæºç ,ç„¶åmysqlé«˜çº§éƒ¨åˆ†,æŠŠæ•°æ®ç»“æ„å’Œç®—æ³•ä¹Ÿæ’¸äº†ä¸€é,åé¢çœ‹äº†zookeeperåˆ†å¸ƒå¼ç›¸å…³,æ¶æ„ç›¸å…³çš„ä¹¦ç±ã€‚ä»ä¸Šå±‚æ¶æ„åˆ°åº•å±‚å®ç°åŸºæœ¬ä¸Šéƒ½äº†è§£äº†,åæ¥åœ¨å·¥ä½œä¸­ä¹Ÿåšäº†åˆ†å¸ƒå¼ç›¸å…³çš„å¼€å‘çš„å·¥ä½œ.çº¿ä¸Šå®•æœºé—®é¢˜æ’æŸ¥è§£å†³.ä»ç†è®ºåˆ°å®è·µ,æŠ€æœ¯å†ä¸€ç‚¹ç‚¹çš„æå‡.</p>
<h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>åšæŒå¥èº«,ä»4æœˆä»½å¼€å§‹,ä¸€ç›´åˆ°å¹´åº•,æ¯å¤©ä¸€å°æ—¶,è™½è¯´å…­å—è…¹è‚Œè¿˜æ²¡ç»ƒå‡ºæ¥,ä½†æ˜¯èº«ä½“ç¡®å®æ¯”ä¹‹å‰å¥½å¤šäº†,è…¹è‚Œä¹Ÿå¿«å‡ºæ¥äº†ğŸ˜‚,2019ç»§ç»­ç»ƒ,åœ¨æˆ‘çš„å½±å“ä¸‹,å¥³ç¥¨ä¹ŸåŠ å…¥å¥èº«é˜Ÿä¼äº†,èº«ä½“ç´ è´¨æå‡äº†ä¸å°‘.</p>
<hr>
<p>æ€»ä½“æ¥è¯´,18å¹´æ˜¯æ‹¼æ,ä»˜å‡º,ä¹Ÿæ˜¯æœ‰æ”¶è·çš„ä¸€å¹´,ç¥æ„¿2019å¹´æ›´ä¸Šä¸€å±‚æ¥¼,å®¶äººèº«ä½“å¥åº·,ä¸€åˆ‡é¡ºé¡ºåˆ©åˆ©.<br><img src="http://ww1.sinaimg.cn/large/007DdbdYly1g03w0hatkxj31400u0dlk.jpg" alt=""></p>
]]></content>
      <categories>
        <category>æ€»ç»“</category>
        <category>life</category>
      </categories>
  </entry>
  <entry>
    <title>mysqläº‹åŠ¡å®ç°åŸç†</title>
    <url>/2019/02/13/mysql/20190213-mysql%E4%BA%8B%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>mysql</category>
        <category>mysql</category>
      </categories>
  </entry>
  <entry>
    <title>2020å¹´åº¦æ€»ç»“</title>
    <url>/2021/01/13/life/20210113-2020%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>2020æ–°å† è‚ºç‚ç–«æƒ…åŸå› ï¼Œæ„Ÿè§‰è¿‡çš„å¾ˆå¿«ã€‚è¿™ä¸€å¹´åœ¨æ–°çš„å…¬å¸è¿‡çš„è¿˜å¯ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼Œæ˜¯è‡ªæˆ‘ä¼‘æ¯ï¼Œè°ƒæ•´çš„ä¸€å¹´å§ã€‚</p>
<h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>æ–°å…¬å¸å¼€å§‹åšä¸šåŠ¡å¼€å‘ï¼Œæ–°çš„ä¸šåŠ¡ï¼Œè°ˆä¸ä¸Šå–œæ¬¢ï¼Œä¹Ÿæ²¡æœ‰ä¸å–œæ¬¢ï¼Œå¯èƒ½æˆ‘çš„æ€§æ ¼å°±æ˜¯ä¸­åº¸ï¼Œè‡³äºè¿™ä¸ªä¸šåŠ¡å¯¹è‡ªå·±æœªæ¥å‘å±•æœ‰ä½•å¸®åŠ©ï¼Œ<br>è‡³å°‘è¿™ä¸ªä¸ä¼šæ¶ˆå¤±ï¼Œä½†æ˜¯å¯¹äºå…¬å¸è¿™ä¸ªä¸šåŠ¡æ˜¯å¦ä¸€è‡´å­˜åœ¨ï¼Œæ˜¯ä¸ªæœªçŸ¥æ•°ã€‚æ¯•ç«Ÿæ˜¯ä¼ ç»Ÿçš„æ‰‹æœºå…¬å¸ï¼Œä½†è‡³å°‘å¯¹äºè¡Œæƒ…ä¸å¥½çš„å…‰æ™¯ï¼Œèƒ½<br>æœ‰ä¸ªç›¸å¯¹ç¨³å®šçš„å·¥ä½œã€‚è‡³äºå·¥ä½œå‹åŠ›å¤§å°å‘¨ç›®å‰å¯ä»¥æ‰¿å—ã€‚</p>
<h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>æ„Ÿè§‰2020è¿˜æ˜¯æ¯”è¾ƒæ•£æ¼«çš„ï¼Œå¥½å¤šåšäº†åŠé“ä¸å¾—ä¸åœä¸‹æ¥çš„ï¼Œæ¯”å¦‚è¯´è½¯è€ƒï¼Œè€ƒç ”ï¼Œ2019å¹´å»äº†neteaseè¯•ç”¨æœŸå°±ç€æ‰‹è€ƒç ”ï¼Œé‚£æ—¶çš„<br>éƒ¨é—¨ç¯å¢ƒæ˜¯ä¸å¤ªé€‚åˆï¼Œä½†è‡³å°‘è¿˜æ˜¯å¤ä¹ äº†æ•°å­¦ï¼Œæ„Ÿè§‰å¯ä»¥æå®šï¼Œè¿™ä¸ªç¡•å£«å­¦ä½æˆ‘æ˜¯ä¸€å®šè¦æ‹¿åˆ°çš„ï¼Œä¹Ÿè®¸æ˜¯ä¹°æˆ¿ç»“å©šåï¼Œä½†æ˜¯ä¸€å®šä¼š<br>åšã€‚<br>è„¾æ°”æ¯”ä¹‹å‰å¤§äº†ï¼Œä¹Ÿè®¸å‹åŠ›å¤§äº†ï¼Œäº‹æƒ…æ¯”è¾ƒå¤šã€‚å¦å¤–18ï¼Œ19å¹´ç¡®å®æ¯”è¾ƒç´¯ï¼ŒæŠ€æœ¯çŸ¥è¯†å­¦äº†æŒºå¤šä¹Ÿæ˜¯åœ¨è¡¥16ï¼Œ17å¹´è¿·å¤±çš„ä¸¤å¹´</p>
<h2 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h2><p>2020å¹´çœ‹äº†ä¸€äº›è®¤çŸ¥æ–¹é¢çš„ä¹¦<br>ã€Šå‘ä¸Šç®¡ç†ã€‹<br>ã€Šæ²Ÿé€šçš„è‰ºæœ¯ã€‹<br>ã€Šä¸‡å†åäº”å¹´ã€‹<br>ã€Šé«˜æ•ˆèƒ½äººå£«çš„7ä¸ªä¹ æƒ¯ã€‹æ²¡çœ‹å®Œ<br>ã€Šè¿·å¤±çš„ç››å®´ã€‹<br>ã€Šéæš´åŠ›æ²Ÿé€šã€‹<br>ä½†æ˜¯æ€»ç»“çš„å¤ªå°‘ï¼ŒåŸºæœ¬çœ‹è¿‡åæ²¡æ€»ç»“ã€‚è¿™ä¸å¤ªå¥½ï¼Œåé¢å¾—æ…¢æ…¢æ”¹æ‰ã€‚</p>
]]></content>
      <categories>
        <category>æ€»ç»“</category>
        <category>life</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸‰ç›®è¿ç®—ç¬¦çš„å‘</title>
    <url>/2019/02/15/java/20190215-%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<p>ä¸‰ç›®è¿ç®—ç¬¦ä¸­çš„å‘ä¸å®¹æ˜“å‘ç°,çœ‹ä¸€æ®µä»£ç <br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Long test &#x3D; null;</span><br><span class="line">        Long a &#x3D;  2 &gt; 1 ? test  : 0L;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Exception in thread â€œmainâ€ java.lang.NullPointerException<br>      at Test.main(Test.java:11)</p>
</blockquote>
<p>æŠ¥çš„NPE,è¿™ä¸ªåœ°æ–¹æŠ¥NPE,ç€å®æƒ³ä¸åˆ°,åªèƒ½çœ‹ä¸‹å­—èŠ‚ç <br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javap -v Test.class &gt; output.txt</span><br></pre></td></tr></table></figure><br>ç»“æœæ˜¯è¿™æ ·çš„<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(java.lang.String[]);</span><br><span class="line">   descriptor: ([Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">   flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">   Code:</span><br><span class="line">     stack&#x3D;2, locals&#x3D;3, args_size&#x3D;1</span><br><span class="line">        0: aconst_null</span><br><span class="line">        1: astore_1</span><br><span class="line">        2: aload_1</span><br><span class="line">        3: invokevirtual #2                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Long.longValue:()J</span><br><span class="line">        6: invokestatic  #3                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Long.valueOf:(J)Ljava&#x2F;lang&#x2F;Long;</span><br><span class="line">        9: astore_2</span><br><span class="line">       10: return</span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line 10: 0</span><br><span class="line">       line 11: 2</span><br><span class="line">       line 12: 10</span><br><span class="line">     LocalVariableTable:</span><br><span class="line">       Start  Length  Slot  Name   Signature</span><br><span class="line">           0      11     0  args   [Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">           2       9     1  test   Ljava&#x2F;lang&#x2F;Long;</span><br><span class="line">          10       1     2     a   Ljava&#x2F;lang&#x2F;Long;</span><br></pre></td></tr></table></figure><br>ç»è¿‡è‡ªåŠ¨çš„æ‹†ç®±å’Œè£…ç®±,è‡³äºä¸ºä½•è¦ç»è¿‡è¿™ä¹ˆä¸€æ­¥å¤„ç† @Sun @Oracle ğŸ˜‚</p>
]]></content>
      <categories>
        <category>java</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>jdkå¸¸ç”¨å·¥å…·æ€»ç»“</title>
    <url>/2019/02/19/java/20190219-jdk%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>å› ä¸ºçº¿ä¸Šæ’æŸ¥é—®é¢˜çš„éœ€è¦,å¦ä¸€ä¸ªä¹Ÿæ˜¯åŸºæœ¬æŠ€èƒ½,å¯¹javaå¸¸ç”¨å·¥å…·åšä¸€ä¸ªå°ç»“.</p>
<h4 id="å¸¸ç”¨çš„å·¥å…·"><a href="#å¸¸ç”¨çš„å·¥å…·" class="headerlink" title="å¸¸ç”¨çš„å·¥å…·"></a>å¸¸ç”¨çš„å·¥å…·</h4><ul>
<li>jar</li>
<li>jarsigner        ç­¾åå·¥å…·,å¯å¯¹æœªç­¾åçš„apkè¿›è¡Œç­¾å</li>
<li>java  </li>
<li>javac             ç¼–è¯‘å·¥å…·</li>
<li>javadoc         ç”Ÿæˆdocæ–‡æ¡£å·¥å…·</li>
<li>javafxpackager    æ‰“åŒ…å·¥å…·,å¯ä»¥ç”Ÿæˆ.exeæ–‡ä»¶</li>
<li>javap             æŸ¥çœ‹.classæ–‡ä»¶çš„å­—èŠ‚ç </li>
<li>javapackager     jdk1.7åè‡ªå¸¦çš„ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°exeå®‰è£…åŒ…</li>
<li>jcmd              æ‰“å°ä¸€ä¸ª Java è¿›ç¨‹çš„ç±»ï¼Œçº¿ç¨‹ä»¥åŠè™šæ‹Ÿæœºä¿¡æ¯ã€‚é€‚åˆç”¨åœ¨è„šæœ¬ä¸­ã€‚ä½¿ç”¨ jcmd - h æ¥æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•ã€‚</li>
<li>jconsole           æä¾› JVM æ´»åŠ¨çš„å›¾å½¢åŒ–å±•ç¤ºï¼ŒåŒ…æ‹¬çº¿ç¨‹ä½¿ç”¨ï¼Œç±»ä½¿ç”¨ä»¥åŠåƒåœ¾å›æ”¶ï¼ˆGCï¼‰ä¿¡æ¯</li>
<li>jdb             è°ƒè¯•å·¥å…·,æ¯”è¾ƒç‰›é€¼</li>
<li>jdeps             åŒ…ä¾èµ–åˆ†æå·¥å…·</li>
<li>jhat              å¸®åŠ©åˆ†æå†…å­˜å †å­˜å‚¨</li>
<li>jinfo             è®¿é—® JVM ç³»ç»Ÿå±æ€§ï¼ŒåŒæ—¶å¯ä»¥åŠ¨æ€ä¿®æ”¹è¿™äº›å±æ€§ã€‚</li>
<li>jmap              æä¾› JVM å†…å­˜ä½¿ç”¨ä¿¡æ¯ï¼Œé€‚ç”¨äºè„šæœ¬ä¸­ã€‚</li>
<li>jmc             æ€§èƒ½ç›‘æ§å·¥å…·</li>
<li>jps             æ˜¾ç¤ºå½“å‰æ‰€æœ‰javaè¿›ç¨‹pidçš„å‘½ä»¤</li>
<li>jstack            æä¾› Java è¿›ç¨‹å†…çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ã€‚</li>
<li>jstat             æä¾› Java åƒåœ¾å›æ”¶ä»¥åŠç±»åŠ è½½ä¿¡æ¯ã€‚</li>
<li>jstatd          ä¸€ä¸ªrmiçš„serveråº”ç”¨ï¼Œç”¨äºç›‘æ§jvmçš„åˆ›å»ºå’Œç»“æŸï¼Œå¹¶ä¸”æä¾›æ¥å£è®©ç›‘æ§å·¥å…·ï¼ˆå¦‚visualvmï¼‰å¯ä»¥è¿œç¨‹è¿æ¥åˆ°æœ¬æœºçš„jvms</li>
<li>jvisualvm         ç›‘æ§ JVM çš„å¯è§†åŒ–å·¥å…·ï¼Œå‰–æè¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºï¼Œåˆ†æ JVM å †å­˜å‚¨ã€‚</li>
</ul>
<p>ä»å¸¸ç”¨çš„å¼€å§‹è®²èµ·</p>
<h4 id="javap"><a href="#javap" class="headerlink" title="javap"></a>javap</h4><p><a href="/2019/02/15/java/ä¸‰ç›®è¿ç®—ç¬¦çš„å‘/">ä¸‰ç›®è¿ç®—ç¬¦</a></p>
<h4 id="jcmd"><a href="#jcmd" class="headerlink" title="jcmd"></a>jcmd</h4><p>å¾…è¡¥å……</p>
<h4 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h4><p>å’ŒjvisualvmåŠŸèƒ½ç›¸ä¼¼,ä½†jvisualvmåŠŸèƒ½æ›´å¼º<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ·»åŠ å¯åŠ¨å‚æ•° -Djava.rmi.server.hostname&#x3D;192.168.0.83 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port&#x3D;9111 -Dcom.sun.management.jmxremote.ssl&#x3D;false -Dcom.sun.management.jmxremote.authenticate&#x3D;false</span><br></pre></td></tr></table></figure><br><img src="http://ww1.sinaimg.cn/mw690/007DdbdYly1g0c06hz75cj30pg106djg.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/007DdbdYly1g0c07fv6r1j31bi0wudog.jpg" alt=""></p>
<h4 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h4><p>ä¸»è¦ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´JVMé…ç½®å‚æ•°</p>
<h5 id="æŸ¥çœ‹jvmå‚æ•°"><a href="#æŸ¥çœ‹jvmå‚æ•°" class="headerlink" title="æŸ¥çœ‹jvmå‚æ•°"></a>æŸ¥çœ‹jvmå‚æ•°</h5><ul>
<li>jinfo -flag <name> PID<br>ç”¨æ³•ï¼šjinfo -flag <name>  PID<br>ä¾‹å¦‚ï¼š<br>jinfo -flag MaxMetaspaceSize 18348ï¼Œå¾—åˆ°ç»“æœ-XX:MaxMetaspaceSize=536870912ï¼Œå³MaxMetaspaceSizeä¸º512M<br>jinfo -flag ThreadStackSize 18348ï¼Œå¾—åˆ°ç»“æœ-XX:ThreadStackSize=256ï¼Œå³Xssä¸º256K</li>
</ul>
<h5 id="ä¿®æ”¹jvmå‚æ•°"><a href="#ä¿®æ”¹jvmå‚æ•°" class="headerlink" title="ä¿®æ”¹jvmå‚æ•°"></a>ä¿®æ”¹jvmå‚æ•°</h5><p>å¦‚æœæ˜¯å¸ƒå°”ç±»å‹çš„JVMå‚æ•°: jinfo -flag [+|-]<name>  PIDï¼Œenable or disable the named VM flag<br>å¦‚æœæ˜¯æ•°å­—/å­—ç¬¦ä¸²ç±»å‹çš„JVMå‚æ•°    jinfo  -flag <name>=<value> PIDï¼Œto set the named VM flag to the given value</p>
<h5 id="å®æ—¶ä¿®æ”¹jvmå‚æ•°"><a href="#å®æ—¶ä¿®æ”¹jvmå‚æ•°" class="headerlink" title="å®æ—¶ä¿®æ”¹jvmå‚æ•°"></a>å®æ—¶ä¿®æ”¹jvmå‚æ•°</h5><p>æ ‡è®°ä¸ºmanageableå¯ä»¥ä¿®æ”¹<br>java -XX:+PrintFlagsInitial | grep manageable<br><img src="http://ww1.sinaimg.cn/mw690/007DdbdYly1g0c0unt4n4j313w0fudkv.jpg" alt=""></p>
<h4 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h4><p>å †å…§å­˜åˆ†æå·¥å…·</p>
<ul>
<li>jmap -heap pid:æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</li>
<li>jmap -histo pidï¼šæŸ¥çœ‹å †ä¸­å¯¹è±¡æ•°é‡å’Œå¤§å°</li>
<li>jmap -dump:format=b,file=heapdump pidï¼šå°†å†…å­˜ä½¿ç”¨çš„è¯¦ç»†æƒ…å†µè¾“å‡ºåˆ°æ–‡ä»¶</li>
<li>jmap -dump:file=./dump.mdump pid<br>jdk8 çš„å †åˆ†æ<br><img src="http://ww1.sinaimg.cn/mw690/007DdbdYly1g0ea6y82r9j30i815oai0.jpg" alt=""></li>
</ul>
<h4 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h4><p>æ˜¾ç¤ºå½“å‰æ‰€æœ‰javaçº¿ç¨‹</p>
<ul>
<li>ç”¨æ³•:<blockquote>
<p>â•°â”€Î» jps -help<br>  usage: jps [-help]</p>
<pre><code>jps [-q] [-mlvV] [&lt;hostid&gt;]
</code></pre><p>  Definitions:<br>  <hostid>:      <hostname>[:<port>]</p>
</blockquote>
</li>
<li>jps -q åªæ˜¾ç¤ºpidï¼Œä¸æ˜¾ç¤ºclassåç§°,jaræ–‡ä»¶åå’Œä¼ é€’ç»™main æ–¹æ³•çš„å‚æ•°</li>
<li>jps -m è¾“å‡ºä¼ é€’ç»™main æ–¹æ³•çš„å‚æ•°ï¼Œåœ¨åµŒå…¥å¼jvmä¸Šå¯èƒ½æ˜¯null</li>
<li><strong>jps -l</strong> è¾“å‡ºåº”ç”¨ç¨‹åºmain classçš„å®Œæ•´packageå æˆ–è€… åº”ç”¨ç¨‹åºçš„jaræ–‡ä»¶å®Œæ•´è·¯å¾„å</li>
<li><strong>jps -v</strong> è¾“å‡ºä¼ é€’ç»™JVMçš„å‚æ•°</li>
<li>jps -V è¾“å‡ºçº¿ç¨‹idå’Œjavaå‘½ä»¤<blockquote>
<p>[root@k ~]# jps -V<br> 21547 Jps<br> 14799 jar</p>
</blockquote>
</li>
</ul>
<h4 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h4><p>æ˜¾ç¤ºçº¿ç¨‹å †æ ˆä¿¡æ¯<br>ä¸»è¦ç›®çš„æ˜¯ç”¨äºå®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´é•¿æ—¶é—´ç­‰å¾…ã€‚</p>
<blockquote>
<p>pidè½¬æ¢æˆ16è¿›åˆ¶ printf â€œ%x\nâ€ pid<br>jstack -l PID &gt; jstack_pid.log<br><img src="http://ww1.sinaimg.cn/mw690/007DdbdYly1g0eb1l59k7j31dq0hi443.jpg" alt=""></p>
</blockquote>
<h4 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h4><p><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</code><br><code>jstat -gcutil pid 2000 10</code><br><code>interval æ¯«ç§’</code></p>
<ul>
<li>jstat â€“class<pid> : æ˜¾ç¤ºåŠ è½½classçš„æ•°é‡ï¼ŒåŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯</li>
<li>jstat -compiler <pid>æ˜¾ç¤ºVMå®æ—¶ç¼–è¯‘çš„æ•°é‡ç­‰ä¿¡æ¯</li>
<li>jstat -gc <pid>: å¯ä»¥æ˜¾ç¤ºgcçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹gcçš„æ¬¡æ•°ï¼ŒåŠæ—¶é—´</li>
<li>jstat -gccapacity <pid>:å¯ä»¥æ˜¾ç¤ºï¼ŒVMå†…å­˜ä¸­ä¸‰ä»£ï¼ˆyoung,old,permï¼‰å¯¹è±¡çš„ä½¿ç”¨å’Œå ç”¨å¤§å°</li>
<li>jstat -gcutil <pid>:ç»Ÿè®¡gcä¿¡æ¯</li>
<li>jstat -gcnew <pid>:å¹´è½»ä»£å¯¹è±¡çš„ä¿¡æ¯</li>
<li>jstat -gcnewcapacity<pid>: å¹´è½»ä»£å¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡</li>
<li>jstat -gcold <pid>ï¼šoldä»£å¯¹è±¡çš„ä¿¡æ¯</li>
<li>jstat -gcoldcapacity <pid>: oldä»£å¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡</li>
<li>jstat -gcpermcapacity<pid>: permå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡</li>
<li>jstat -printcompilation <pid>ï¼šå½“å‰VMæ‰§è¡Œçš„ä¿¡æ¯</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>jdk</tag>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>page</title>
    <url>/2019/04/24/java/20190424-%E5%8E%9F%E5%AD%90%E6%80%A7/</url>
    <content><![CDATA[<ol>
<li>synchronized</li>
<li>volatile</li>
<li>reentrantLock</li>
<li>synchronizedå’ŒreentrantLockçš„å¯¹æ¯”</li>
<li>AQSåº•å±‚æ€ä¹ˆå®ç°çš„</li>
<li>èµ‹å€¼æ“ä½œæ˜¯åŸå­çš„å—</li>
<li>atomicåŒ…å¦‚ä½•å®ç°çš„ï¼Ÿ</li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>page</title>
    <url>/2019/04/24/java/20190424-%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<h3 id="1-çº¿ç¨‹æ± å¦‚ä½•å®ç°çš„"><a href="#1-çº¿ç¨‹æ± å¦‚ä½•å®ç°çš„" class="headerlink" title="1. çº¿ç¨‹æ± å¦‚ä½•å®ç°çš„"></a>1. çº¿ç¨‹æ± å¦‚ä½•å®ç°çš„</h3><h3 id="2-çº¿ç¨‹æ± å„ä¸ªå‚æ•°-é‡ç‚¹é˜Ÿåˆ—"><a href="#2-çº¿ç¨‹æ± å„ä¸ªå‚æ•°-é‡ç‚¹é˜Ÿåˆ—" class="headerlink" title="2. çº¿ç¨‹æ± å„ä¸ªå‚æ•° -é‡ç‚¹é˜Ÿåˆ—"></a>2. çº¿ç¨‹æ± å„ä¸ªå‚æ•° -é‡ç‚¹é˜Ÿåˆ—</h3><h3 id="3-æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ— ç•Œé˜Ÿåˆ—å¦‚ä½•å®ç°çš„"><a href="#3-æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ— ç•Œé˜Ÿåˆ—å¦‚ä½•å®ç°çš„" class="headerlink" title="3. æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ— ç•Œé˜Ÿåˆ—å¦‚ä½•å®ç°çš„"></a>3. æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ— ç•Œé˜Ÿåˆ—å¦‚ä½•å®ç°çš„</h3>]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡çº¿ä¸Šcpuè¿‡é«˜é—®é¢˜æ’æŸ¥</title>
    <url>/2019/02/14/prd/20190214-%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Acpu%E8%BF%87%E9%AB%98%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/</url>
    <content><![CDATA[<h3 id="é—®é¢˜èƒŒæ™¯"><a href="#é—®é¢˜èƒŒæ™¯" class="headerlink" title="é—®é¢˜èƒŒæ™¯"></a>é—®é¢˜èƒŒæ™¯</h3>]]></content>
      <categories>
        <category>çº¿ä¸Šé—®é¢˜</category>
        <category>prd</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>page</title>
    <url>/2021/01/14/spring/20210114-springboot%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9001/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>springçŸ¥è¯†ç‚¹æ€»ç»“</title>
    <url>/2019/02/13/spring/20190213-spring%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h3 id="1-beanç”Ÿå‘½å‘¨æœŸ"><a href="#1-beanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1. beanç”Ÿå‘½å‘¨æœŸ"></a>1. beanç”Ÿå‘½å‘¨æœŸ</h3><p><img src="http://ww1.sinaimg.cn/large/007DdbdYly1g04kbgr6vlj31uo0tzdpq.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Spring å®¹å™¨æ ¹æ®é…ç½®ä¸­çš„ Bean Definition(å®šä¹‰)ä¸­å¯¹beanè¿›è¡Œå®ä¾‹åŒ–</span><br><span class="line"></span><br><span class="line">springå°†å€¼å’Œbeançš„å¼•ç”¨å¼•å…¥åˆ°beanå¯¹åº”çš„å±æ€§ä¸­</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†BeanNameAwareæ¥å£,springå°†beançš„idä¼ é€’ç»™setBeanNameæ–¹æ³•</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†BeanFactoryAwareæ¥å£,springå°†è°ƒç”¨setBeanFactoryæ–¹æ³•å¼•å…¥beanFactory</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†BeanApplicationContextAwareæ¥å£,springå°†è°ƒç”¨setApplicationContextæ–¹æ³•å¼•å…¥applicationContext</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£,springå°†è°ƒç”¨å®ƒä»¬çš„postProcessBeforeInitializationæ–¹æ³• @PostConstructæ³¨è§£çš„æ–¹æ³•æ˜¯ç”± CommonAnnotationBeanPostProcessorç±»å¤„ç†,è¯¥ç±»ç»§æ‰¿InitDestroyAnnotationBeanPostProcessor</span><br><span class="line">beanåˆå§‹åŒ–å’Œé”€æ¯çš„ä¸€ä¸ªå¤„ç†å™¨</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†InitializingBeanæ¥å£,springå°†è°ƒç”¨afterPropertiesSetæ–¹æ³•</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanä½¿ç”¨init-methodå£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£,springå°†è°ƒç”¨å®ƒä»¬çš„postProcessAfterInitializationæ–¹æ³•</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶beanå·²ç»å°±ç»ª,å°†ä¸€ç›´å­˜åœ¨ä¸Šä¸‹æ–‡ä¸­,ç›´åˆ°ä¸Šä¸‹æ–‡é”€æ¯</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanå®ç°äº†DisposableBeanæ¥å£,springå°†è°ƒç”¨destroyæ¥å£æ–¹æ³•</span><br><span class="line"></span><br><span class="line">å¦‚æœbeanä½¿ç”¨destroy-methodå£°æ˜äº†é”€æ¯æ–¹æ³•,åˆ™è¯¥æ–¹æ³•è¢«è°ƒç”¨</span><br></pre></td></tr></table></figure>
<h3 id="2-åˆå§‹åŒ–æ–¹æ³•-é”€æ¯æ–¹æ³•æ‰§è¡Œçš„å…ˆåé¡ºåº"><a href="#2-åˆå§‹åŒ–æ–¹æ³•-é”€æ¯æ–¹æ³•æ‰§è¡Œçš„å…ˆåé¡ºåº" class="headerlink" title="2. åˆå§‹åŒ–æ–¹æ³•,é”€æ¯æ–¹æ³•æ‰§è¡Œçš„å…ˆåé¡ºåº"></a>2. åˆå§‹åŒ–æ–¹æ³•,é”€æ¯æ–¹æ³•æ‰§è¡Œçš„å…ˆåé¡ºåº</h3><ul>
<li>åˆå§‹åŒ–<br>(postProcessor)@PostConstruct -&gt; (InitializingBean)afterPropertiesSet -&gt; init-methodå£°æ˜çš„æ–¹æ³•</li>
<li>é”€æ¯<br>(postProcessor)@PreDestroy -&gt; (DisposableBean)destory -&gt; destroy-methodå£°æ˜çš„æ–¹æ³•</li>
</ul>
<h3 id="3-springå®¹å™¨-applicationContextå’ŒbeanFactoryçš„åŒºåˆ«"><a href="#3-springå®¹å™¨-applicationContextå’ŒbeanFactoryçš„åŒºåˆ«" class="headerlink" title="3. springå®¹å™¨ applicationContextå’ŒbeanFactoryçš„åŒºåˆ«"></a>3. springå®¹å™¨ applicationContextå’ŒbeanFactoryçš„åŒºåˆ«</h3><p>Beanfactory å’Œ ApplicationContextæ˜¯springçš„ä¸¤ç§IoCå®¹å™¨</p>
<ul>
<li>Beanfactoryæ˜¯ç®€å•çš„ä½çº§å®¹å™¨,æä¾›IoCåŠŸèƒ½çš„å®ç°,å¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªmap,é€šè¿‡getBeanæ–¹æ³•è·å–bean</li>
<li>ApplicationContextæ˜¯æ›´é«˜çº§çš„å®¹å™¨,æŠ½è±¡åŸºç±»AbstractApplicationContextçš„å­ç±»AbstractRefreshableApplicationContextä¾èµ–DefaultListableBeanFactory,æ‰€ä»¥è¯´IoCåŠŸèƒ½æ˜¯beanFactoryå®ç°<br>æ ¹æ®applicationContextç»§æ‰¿çš„æ¥å£å¯ä»¥å‘ç°,æœ‰å¦‚ä¸‹åŠŸèƒ½<br>MessageSource:ç®¡ç† message,å®ç°å›½é™…åŒ–ç­‰åŠŸèƒ½ã€‚<br>ApplicationEventPublisher:äº‹ä»¶å‘å¸ƒã€‚<br>ResourcePatternResolver:å¤šèµ„æºåŠ è½½ã€‚<br>EnvironmentCapable:ç³»ç»Ÿ Environmentï¼ˆprofile + Propertiesï¼‰ç›¸å…³ã€‚<br>Lifecycle:ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚<br>Closable:å…³é—­,é‡Šæ”¾èµ„æº<br>InitializingBean:è‡ªå®šä¹‰åˆå§‹åŒ–ã€‚<br>BeanNameAware:è®¾ç½® beanName çš„ Aware æ¥å£ã€‚</li>
<li>spring IoC ä¸¤ä¸ªæ­¥éª¤<br>  a. åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè§£ææˆ BeanDefinition æ”¾åœ¨ Map é‡Œã€‚<br>  b. è°ƒç”¨ getBean çš„æ—¶å€™ï¼Œä» BeanDefinition æ‰€å±çš„ Map é‡Œï¼Œæ‹¿å‡º Class å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼ŒåŒæ—¶ï¼Œå¦‚æœæœ‰ä¾èµ–å…³ç³»ï¼Œå°†é€’å½’è°ƒç”¨ getBean æ–¹æ³• â€”â€” å®Œæˆä¾èµ–æ³¨å…¥ã€‚<br>  å®ç°æœºåˆ¶:å·¥å‚æ¨¡å¼åŠ åå°„æœºåˆ¶<br>å¯¹æ¯”:</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">BeanFactory</th>
<th style="text-align:left">ApplicationContext</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ƒä½¿ç”¨æ‡’åŠ è½½</td>
<td style="text-align:left">å¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½</td>
</tr>
<tr>
<td style="text-align:left">å®ƒä½¿ç”¨è¯­æ³•æ˜¾å¼æä¾›èµ„æºå¯¹è±¡</td>
<td style="text-align:left">å®ƒè‡ªå·±åˆ›å»ºå’Œç®¡ç†èµ„æºå¯¹è±¡</td>
</tr>
<tr>
<td style="text-align:left">ä¸æ”¯æŒå›½é™…åŒ–</td>
<td style="text-align:left">æ”¯æŒå›½é™…åŒ–</td>
</tr>
<tr>
<td style="text-align:left">ä¸æ”¯æŒåŸºäºä¾èµ–çš„æ³¨è§£</td>
<td style="text-align:left">æ”¯æŒåŸºäºä¾èµ–çš„æ³¨è§£</td>
</tr>
<tr>
<td style="text-align:left">XmlBeanFactory</td>
<td style="text-align:left">ClassPathXmlApplicationContext<br>FileSystemXmlApplicationContext<br>XmlWebApplicationContext<br>ConfigServletWebServerApplicationContext</td>
</tr>
</tbody>
</table>
<h3 id="Spring-æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ"><a href="#Spring-æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ" class="headerlink" title="Spring æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ"></a>Spring æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ</h3><p>äº”ç§æ ‡å‡†çš„äº‹ä»¶</p>
<ul>
<li>ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰</li>
<li>ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶ï¼ˆContextStartedEventï¼‰</li>
<li>ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶ï¼ˆContextStoppedEventï¼‰</li>
<li>ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶ï¼ˆContextClosedEventï¼‰</li>
<li>è¯·æ±‚å¤„ç†äº‹ä»¶ï¼ˆRequestHandledEventï¼‰<h3 id="4-springä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼"><a href="#4-springä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="4. springä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼"></a>4. springä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼</h3></li>
<li>ä»£ç†æ¨¡å¼<br/><br>  ç½‘å…³çš„è®¾è®¡å°±æ˜¯ä½¿ç”¨çš„ä»£ç†æ¨¡å¼<br/><br>  springä¸­AOPæ˜¯åŸºäºjdkåŠ¨æ€ä»£ç†å’ŒåŠ¨æ€å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯å®ç°çš„,</li>
<li>ç­–ç•¥æ¨¡å¼</li>
</ul>
<h3 id="5-aopå®ç°åŸç†"><a href="#5-aopå®ç°åŸç†" class="headerlink" title="5. aopå®ç°åŸç†"></a>5. aopå®ç°åŸç†</h3><blockquote>
<p>   aopåº•å±‚æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶å’Œå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯å³cglibå®ç°.jdkåŠ¨æ€ä»£ç†å®ç°,ä»£ç†çš„ç±»å¿…é¡»å®ç°æ¥å£;å­—èŠ‚ç ç”Ÿæˆåˆ™æ˜¯é€šè¿‡ç”Ÿæˆä»£ç†ç±»çš„ä¸€ä¸ªå­ç±»,å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•,ä¸ç®¡ä»£ç†ç±»æœ‰æ²¡æœ‰å®ç°æ¥å£,ä½†æ˜¯å¯¹finalæ–¹æ³•æ— æ³•è¦†å†™.<br/></p>
</blockquote>
<ul>
<li><p>jdkåŠ¨æ€ä»£ç†</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 1. é¦–å…ˆå®ç°ä¸€ä¸ªInvocationHandlerï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„invoke()æ–¹æ³•ã€‚</span><br><span class="line">public class DynamicProxyHandler implements InvocationHandler &#123;</span><br><span class="line">    private Object proxied;</span><br><span class="line">    public DynamicProxyHandler(Object proxied) &#123;</span><br><span class="line">        System.out.println(&quot;dynamic proxy handler constuctor: &quot; + proxied.getClass());</span><br><span class="line">        this.proxied &#x3D; proxied;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;dynamic proxy name: &quot; + proxy.getClass());</span><br><span class="line">        System.out.println(&quot;method: &quot; + method.getName());</span><br><span class="line">        System.out.println(&quot;args: &quot; + Arrays.toString(args));</span><br><span class="line">        </span><br><span class="line">        Object invokeObject &#x3D; method.invoke(proxied, args);</span><br><span class="line">        if (invokeObject !&#x3D; null) &#123;</span><br><span class="line">            System.out.println(&quot;invoke object: &quot; + invokeObject.getClass());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            System.out.println(&quot;invoke object is null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return invokeObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 2.åŠ¨æ€ä»£ç†</span><br><span class="line">ClassLoader classLoader &#x3D; Interface.class.getClassLoader();</span><br><span class="line">Class&lt;?&gt;[] interfaces &#x3D; new Class[] &#123; Interface.class &#125;;</span><br><span class="line">InvocationHandler handler &#x3D; new DynamicProxyHandler(realObject);</span><br><span class="line">Interface proxy &#x3D; (Interface) Proxy.newProxyInstance(classLoader, interfaces, handler); </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<blockquote>
<p>   loaderï¼ŒæŒ‡å®šä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨<br>  interfacesï¼Œä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ¥å£<br>  handlerï¼Œæ–¹æ³•è°ƒç”¨çš„å®é™…å¤„ç†è€…ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°è¿™é‡Œï¼ˆæ³¨æ„1)<br>  newProxyInstance()ä¼šè¿”å›ä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£çš„ä»£ç†å¯¹è±¡ï¼Œå¯¹è¯¥å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘ç»™InvocationHandler.invoke()æ–¹æ³•ã€‚ç†è§£ä¸Šè¿°ä»£ç éœ€è¦å¯¹Javaåå°„æœºåˆ¶æœ‰ä¸€å®šäº†è§£ã€‚åŠ¨æ€ä»£ç†ç¥å¥‡çš„åœ°æ–¹å°±æ˜¯ä»£ç†å¯¹è±¡æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶äº§ç”Ÿçš„ï¼Œè€Œä¸æ˜¯ç¼–è¯‘æœŸ<br>  å¯¹ä»£ç†å¯¹è±¡çš„æ‰€æœ‰æ¥å£æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°InvocationHandler.invoke()æ–¹æ³•ï¼Œåœ¨invoke()æ–¹æ³•é‡Œæˆ‘ä»¬å¯ä»¥åŠ å…¥ä»»ä½•é€»è¾‘ï¼Œæ¯”å¦‚ä¿®æ”¹æ–¹æ³•å‚æ•°ï¼ŒåŠ å…¥æ—¥å¿—åŠŸèƒ½ã€å®‰å…¨æ£€æŸ¥åŠŸèƒ½ç­‰ï¼›ä¹‹åæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼æ‰§è¡ŒçœŸæ­£çš„æ–¹æ³•ä½“ï¼Œç¤ºä¾‹ä¸­é€šè¿‡åå°„è°ƒç”¨äº†Helloå¯¹è±¡çš„ç›¸åº”æ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡RPCè°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚</p>
</blockquote>
</li>
</ul>
<ul>
<li>åŠ¨æ€å­—èŠ‚ç ç”Ÿæˆ cglib <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 1. é¦–å…ˆå®ç°ä¸€ä¸ªMethodInterceptorï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„intercept()æ–¹æ³•ã€‚</span><br><span class="line">class MyMethodInterceptor implements MethodInterceptor&#123;</span><br><span class="line">  ...</span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123;</span><br><span class="line">        logger.info(&quot;You said: &quot; + Arrays.toString(args));</span><br><span class="line">        return proxy.invokeSuper(obj, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 2. ç„¶ååœ¨éœ€è¦ä½¿ç”¨HelloConcreteçš„æ—¶å€™ï¼Œé€šè¿‡CGLIBåŠ¨æ€ä»£ç†è·å–ä»£ç†å¯¹è±¡ã€‚</span><br><span class="line">Enhancer enhancer &#x3D; new Enhancer();</span><br><span class="line">enhancer.setSuperclass(HelloConcrete.class);</span><br><span class="line">enhancer.setCallback(new MyMethodInterceptor());</span><br><span class="line"> </span><br><span class="line">HelloConcrete hello &#x3D; (HelloConcrete)enhancer.create();</span><br><span class="line">System.out.println(hello.sayHello(&quot;I love you!&quot;));</span><br></pre></td></tr></table></figure>
<h3 id="6-spingå¦‚ä½•è§£å†³å¾ªè½¬ä¾èµ–"><a href="#6-spingå¦‚ä½•è§£å†³å¾ªè½¬ä¾èµ–" class="headerlink" title="6. spingå¦‚ä½•è§£å†³å¾ªè½¬ä¾èµ–"></a>6. spingå¦‚ä½•è§£å†³å¾ªè½¬ä¾èµ–</h3>å¾ªç¯ä¾èµ–ç°è±¡:A ä¾èµ– Bï¼ŒB ä¾èµ– Cï¼ŒC ä¾èµ– A,ç„¶åAåˆå§‹åŒ–æ—¶å‘ç°ä¾èµ–B,åˆ™åˆ›å»ºB;Båˆå§‹åŒ–å‘ç°ä¾èµ–C,åˆ™åˆ›å»ºC;Cå‘ç°ä¾èµ–A,åˆåˆ›å»ºA,å½¢æˆæ— é™å¾ªç¯.å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="http://ww1.sinaimg.cn/large/007DdbdYly1g08ez3lvs3j308k06xdfv.jpg" alt=""><br>Spring å¾ªç¯ä¾èµ–çš„åœºæ™¯æœ‰ä¸¤ç§ï¼š</li>
</ul>
<ul>
<li>æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ã€‚</li>
<li>field å±æ€§çš„å¾ªç¯ä¾èµ–ã€‚</li>
</ul>
<blockquote>
<p>å¯¹äºæ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼ŒSpring æ˜¯æ— æ³•è§£å†³çš„ï¼Œåªèƒ½æŠ›å‡º BeanCurrentlyInCreationException å¼‚å¸¸è¡¨ç¤ºå¾ªç¯ä¾èµ–.<br>Spring åªè§£å†³ scope ä¸º singleton çš„å¾ªç¯ä¾èµ–ã€‚å¯¹äºscope ä¸º prototype çš„ bean ï¼ŒSpring æ— æ³•è§£å†³ï¼Œç›´æ¥æŠ›å‡º BeanCurrentlyInCreationException å¼‚å¸¸</p>
</blockquote>
<h6 id="ä»AbstractBeanFactory-doGetBeanæ–¹æ³•å¼€å§‹"><a href="#ä»AbstractBeanFactory-doGetBeanæ–¹æ³•å¼€å§‹" class="headerlink" title="ä»AbstractBeanFactory doGetBeanæ–¹æ³•å¼€å§‹,"></a>ä»AbstractBeanFactory doGetBeanæ–¹æ³•å¼€å§‹,</h6><p><code>Object sharedInstance = getSingleton(beanName);</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Object getSingleton(String beanName) &#123;</span><br><span class="line">    return getSingleton(beanName, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Return the (raw) singleton object registered under the given name.</span><br><span class="line"> * &lt;p&gt;Checks already instantiated singletons and also allows for an early</span><br><span class="line"> * reference to a currently created singleton (resolving a circular reference).</span><br><span class="line"> * @param beanName the name of the bean to look for</span><br><span class="line"> * @param allowEarlyReference whether early references should be created or not</span><br><span class="line"> * @return the registered singleton object, or &#123;@code null&#125; if none found</span><br><span class="line"> *&#x2F;</span><br><span class="line">protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123;</span><br><span class="line">    Object singletonObject &#x3D; this.singletonObjects.get(beanName);</span><br><span class="line">    if (singletonObject &#x3D;&#x3D; null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">        synchronized (this.singletonObjects) &#123;</span><br><span class="line">            singletonObject &#x3D; this.earlySingletonObjects.get(beanName);</span><br><span class="line">            if (singletonObject &#x3D;&#x3D; null &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                ObjectFactory&lt;?&gt; singletonFactory &#x3D; this.singletonFactories.get(beanName);</span><br><span class="line">                if (singletonFactory !&#x3D; null) &#123;</span><br><span class="line">                    singletonObject &#x3D; singletonFactory.getObject();</span><br><span class="line">                    this.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                    this.singletonFactories.remove(beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return (singletonObject !&#x3D; NULL_OBJECT ? singletonObject : null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>getSingletonä¼šä»ä¸‰ä¸ªç¼“å­˜ä¸­æŸ¥,åˆ†åˆ«æ˜¯:<code>singletonObjectsã€earlySingletonObjectsã€singletonFactories</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Cache of singleton objects: bean name to bean instance.</span><br><span class="line"> *</span><br><span class="line"> * å­˜æ”¾çš„æ˜¯å•ä¾‹ bean çš„æ˜ å°„ã€‚</span><br><span class="line"> *</span><br><span class="line"> * å¯¹åº”å…³ç³»ä¸º bean name --&gt; bean instance</span><br><span class="line"> *&#x2F;</span><br><span class="line">private final Map&lt;String, Object&gt; singletonObjects &#x3D; new ConcurrentHashMap&lt;&gt;(256);</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Cache of singleton factories: bean name to ObjectFactory.</span><br><span class="line"> *</span><br><span class="line"> * å­˜æ”¾çš„æ˜¯ã€æ—©æœŸã€‘çš„å•ä¾‹ bean çš„æ˜ å°„ã€‚</span><br><span class="line"> *</span><br><span class="line"> * å¯¹åº”å…³ç³»ä¹Ÿæ˜¯ bean name --&gt; bean instanceã€‚</span><br><span class="line"> *</span><br><span class="line"> * å®ƒä¸ &#123;@link #singletonObjects&#125; çš„åŒºåˆ«åŒºåˆ«åœ¨ï¼Œäº earlySingletonObjects ä¸­å­˜æ”¾çš„ bean ä¸ä¸€å®šæ˜¯å®Œæ•´çš„ã€‚</span><br><span class="line"> *</span><br><span class="line"> * ä» &#123;@link #getSingleton(String)&#125; æ–¹æ³•ä¸­ï¼Œä¸­æˆ‘ä»¬å¯ä»¥äº†è§£ï¼Œbean åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­å°±å·²ç»åŠ å…¥åˆ° earlySingletonObjects ä¸­äº†ï¼Œ</span><br><span class="line"> * æ‰€ä»¥å½“åœ¨ bean çš„åˆ›å»ºè¿‡ç¨‹ä¸­å°±å¯ä»¥é€šè¿‡ getBean() æ–¹æ³•è·å–ã€‚</span><br><span class="line"> * è¿™ä¸ª Map ä¹Ÿæ˜¯è§£å†³ã€å¾ªç¯ä¾èµ–ã€‘çš„å…³é”®æ‰€åœ¨ã€‚</span><br><span class="line"> **&#x2F;</span><br><span class="line">private final Map&lt;String, Object&gt; earlySingletonObjects &#x3D; new HashMap&lt;&gt;(16);</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">  * Cache of early singleton objects: bean name to bean instance.</span><br><span class="line">  *</span><br><span class="line">  * å­˜æ”¾çš„æ˜¯ early objects çš„æ˜ å°„ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ›å»ºå•ä¾‹ bean çš„ factory ã€‚</span><br><span class="line">  *</span><br><span class="line">  * å¯¹åº”å…³ç³»æ˜¯ bean name --&gt; object</span><br><span class="line">  *&#x2F;</span><br><span class="line">private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories &#x3D; new HashMap&lt;&gt;(16);</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªä¸‰çº§ç¼“å­˜:</p>
<ul>
<li>ç¬¬ä¸€çº§ä¸º singletonObjects</li>
<li>ç¬¬äºŒçº§ä¸º earlySingletonObjects</li>
<li>ç¬¬ä¸‰çº§ä¸º singletonFactories<blockquote>
<p>é¦–å…ˆï¼Œä»ä¸€çº§ç¼“å­˜ singletonObjects è·å–ã€‚<br>å¦‚æœï¼Œæ²¡æœ‰ä¸”å½“å‰æŒ‡å®šçš„ beanName æ­£åœ¨åˆ›å»ºï¼Œå°±å†ä»äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­è·å–ã€‚<br>å¦‚æœï¼Œè¿˜æ˜¯æ²¡æœ‰è·å–åˆ°ä¸”å…è®¸ singletonFactories é€šè¿‡ #getObject() è·å–ï¼Œåˆ™ä»ä¸‰çº§ç¼“å­˜ singletonFactories è·å–ã€‚å¦‚æœè·å–åˆ°ï¼Œåˆ™é€šè¿‡å…¶ #getObject() æ–¹æ³•ï¼Œè·å–å¯¹è±¡ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­ï¼Œå¹¶ä»ä¸‰çº§ç¼“å­˜ singletonFactories åˆ é™¤</p>
</blockquote>
</li>
</ul>
<p><strong>å…³é”®ç‚¹ï¼šæ·»åŠ è‡³ä¸‰çº§ç¼“å­˜</strong><br>ä½¿ç”¨beançš„æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ è‡³ä¸‰çº§ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™çš„beanæ²¡æœ‰å±æ€§å¡«å……ï¼Œä½†æ˜¯beanå·²ç»å­˜åœ¨äº†ã€‚</p>
<p><strong>æ¯ä¸€å±‚ç¼“å­˜æ˜¯ ä¸‰çº§ç¼“å­˜ä¸­è·å–åˆ° ä¼šæ·»åŠ è‡³äºŒçº§ç¼“å­˜,ç„¶ååˆ é™¤ä¸‰çº§ç¼“å­˜,æœ€ç»ˆåªä¼šåœ¨ä¸€çº§ç¼“å­˜ä¸­å­˜åœ¨</strong></p>
<blockquote>
<p>æœ€ç»ˆå¾ªç¯ä¾èµ– Spring è§£å†³çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆ A å®Œæˆåˆå§‹åŒ–ç¬¬ä¸€æ­¥å¹¶å°†è‡ªå·±æå‰æ›å…‰å‡ºæ¥ï¼ˆé€šè¿‡ ObjectFactory å°†è‡ªå·±æå‰æ›å…‰ï¼‰ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå‘ç°è‡ªå·±ä¾èµ–å¯¹è±¡ Bï¼Œæ­¤æ—¶å°±ä¼šå»å°è¯• get(B)ï¼Œè¿™ä¸ªæ—¶å€™å‘ç° B è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥</li>
<li>ç„¶å B å°±èµ°åˆ›å»ºæµç¨‹ï¼Œåœ¨ B åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒåŒæ ·å‘ç°è‡ªå·±ä¾èµ– Cï¼ŒC ä¹Ÿæ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥</li>
<li>è¿™ä¸ªæ—¶å€™ C åˆå¼€å§‹åˆå§‹åŒ–è¿›ç¨‹ï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­å‘ç°è‡ªå·±ä¾èµ– Aï¼Œäºæ˜¯å°è¯• get(A)ï¼Œè¿™ä¸ªæ—¶å€™ç”±äº A å·²ç»æ·»åŠ è‡³ç¼“å­˜ä¸­ï¼ˆä¸€èˆ¬éƒ½æ˜¯æ·»åŠ è‡³ä¸‰çº§ç¼“å­˜ singletonFactories ï¼‰ï¼Œé€šè¿‡ ObjectFactory æå‰æ›å…‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ ObjectFactory#getObject() æ–¹æ³•æ¥æ‹¿åˆ° A å¯¹è±¡ï¼ŒC æ‹¿åˆ° A å¯¹è±¡åé¡ºåˆ©å®Œæˆåˆå§‹åŒ–ï¼Œç„¶åå°†è‡ªå·±æ·»åŠ åˆ°ä¸€çº§ç¼“å­˜ä¸­</li>
<li>å›åˆ° B ï¼ŒB ä¹Ÿå¯ä»¥æ‹¿åˆ° C å¯¹è±¡ï¼Œå®Œæˆåˆå§‹åŒ–ï¼ŒA å¯ä»¥é¡ºåˆ©æ‹¿åˆ° B å®Œæˆåˆå§‹åŒ–ã€‚åˆ°è¿™é‡Œæ•´ä¸ªé“¾è·¯å°±å·²ç»å®Œæˆäº†åˆå§‹åŒ–è¿‡ç¨‹äº†</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>spring</category>
        <category>spring</category>
      </categories>
  </entry>
</search>
